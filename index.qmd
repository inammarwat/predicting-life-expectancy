---
title: "Predicting Life Expectancy"
author: "Inam Khan"
execute:
  echo: false
  message: false
  warning: false
---

```{r}
# message : false
# Load required libraries
library(tidyverse)  # Data manipulation and visualization
library(broom)      # Tidy model outputs
library(tidymodels) # Modeling framework
library(ggplot2)    # Data visualization
library(readxl)     # Read Excel files
library(plotly)     # Interactive plots
library(dplyr)      # Data wrangling
library(forcats)
library(ggtext)  # If you want markdown styling
```

```{r}
# Read cleaned life expectancy dataset from Excel file
data <- read_excel("data/life_expectancy_cleaned_dataset.xlsx")
```


```{r}
# Fit a multiple linear regression model to predict life expectancy
# Include key predictors: adult mortality, income composition, HIV/AIDS prevalence, schooling, and GDP (log-transformed)
model <- lm(Life_expectancy ~ 
              Adult_Mortality + 
              Income_composition_of_resources + 
              `HIV/AIDS` + 
              Schooling + 
              log(GDP + 1),  # Log-transform GDP to reduce skewness
            data = data)
```

```{r regression-impact-plot, fig.width=11, fig.height=6}
# Visualize the effect of key predictors on life expectancy using regression estimates

# Prepare tidy_model
tidy_model <- tidy(model) %>% 
  filter(term != "(Intercept)") %>% 
  mutate(
    term = case_when(
      term == "Adult_Mortality" ~ "Adult Mortality\n(deaths per 1,000)",
      term == "Income_composition_of_resources" ~ "Income & Resources",
      term == "HIV/AIDS" ~ "HIV Prevalence\n(% of population)",
      term == "Schooling" ~ "Education\n(years in school)",
      term == "log(GDP + 1)" ~ "National Wealth\n(log GDP)",
      TRUE ~ term
    ),
    term = fct_reorder(term, estimate)
  )

# Plot
ggplot(tidy_model, aes(x = term, y = estimate)) +
  geom_col(aes(fill = estimate > 0), width = 0.6, alpha = 0.9) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  scale_fill_manual(values = c("TRUE" = "#1f77b4", "FALSE" = "#d62728"), guide = FALSE) +
  scale_y_continuous(
    limits = c(-max(abs(tidy_model$estimate)) * 1.2, max(abs(tidy_model$estimate)) * 1.2),
    breaks = scales::pretty_breaks(n = 6),
    labels = function(x) sprintf("%+.1f years", x)
  ) +
  coord_flip() +
  labs(
    title = "Impact of Health and Socioeconomic Factors on Life Expectancy",
    subtitle = "Education and income increase lifespan, while HIV and adult mortality reduce it",
    x = NULL,
    y = "Change in Life Expectancy (years)",
    caption = "Data source: WHO Global Data (2000–2015) | Kaggle"
  ) +
  theme_classic(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 20, hjust = 0.5, margin = margin(b = 8)),
    plot.subtitle = element_text(size = 14, hjust = 0.5, color = "gray40"),
    axis.text.y = element_text(face = "bold", size = 12),
    axis.text.x = element_text(size = 11),
    plot.caption = element_text(color = "gray50", size = 10, margin = margin(t = 10)),
    plot.margin = margin(t = 25, r = 20, b = 20, l = 20)
  ) +
  geom_text(
    aes(label = sprintf("%+.2f", estimate)),
    hjust = ifelse(tidy_model$estimate > 0, -0.2, 1.2),
    size = 4.5,
    fontface = "bold"
  )
```

## Summary

**How do health and socioeconomic factors influence life expectancy globally?**  
I used data compiled by the World Health Organization and the United Nations Development Programme, covering health and socioeconomic indicators for over 190 countries from 2000 to 2015. After cleaning and standardizing the data, I focused on comparing the effect of economic resources, education levels, and disease prevalence on national life expectancy.  
I built a multiple linear regression model to predict life expectancy (measured in years), using factors such as adult mortality, HIV/AIDS prevalence, years of schooling, and national income levels. The model showed that higher income composition increased life expectancy by **+10.8 years**, while HIV/AIDS prevalence and adult mortality had negative effects of **−0.44** and **−0.02 years**, respectively.  
**Income inequality and health interventions can shift life expectancy by more than a decade — and that gap may grow without investment in education and disease prevention.**
